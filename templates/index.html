<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Car Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- Top Navbar -->
        <nav class="top-navbar">
            <div class="navbar-left">
                <i class="fas fa-robot"></i>
                <h1>Xe tu hanh car</h1>
            </div>
            <div class="navbar-right">
                <div class="connection-badge" id="connectionBadge">
                    <i class="fas fa-bolt"></i>
                    <span id="connectionText">Connecting...</span>
                </div>
            </div>
        </nav>

        <div class="content-grid">
            <!-- Row 1: Camera & Main Control -->
            <div class="grid-row-1">
                <!-- Video Feed -->
                <div class="panel video-panel">
                    <div class="panel-header">
                        <i class="fas fa-eye"></i> LIVE VISION
                        <span class="stream-info">AI Active</span>
                    </div>
                    <div class="panel-body video-body">
                        <div class="video-frame">
                            <img src="/video_feed" alt="Camera Feed" id="videoStream">
                            <div class="ai-overlay">
                                <span class="overlay-tag">Lane Detect</span>
                                <span class="overlay-tag">Sign Detect</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Status & Control -->
                <div class="panel status-panel">
                    <div class="panel-header">
                        <i class="fas fa-tachometer-alt"></i> CONTROL CENTER
                    </div>
                    <div class="panel-body status-body">
                        <!-- Auto Switch -->
                        <div class="control-group">
                            <label class="status-label">Auto Pilot</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoModeSwitch" onchange="toggleAutoMode()">
                                <label class="form-check-label fw-bold" for="autoModeSwitch" id="autoModeLabel">OFF</label>
                            </div>
                        </div>

                        <!-- Speed Setting -->
                        <div class="control-group mt-3">
                            <label class="status-label">Base Speed</label>
                            <input type="range" class="speed-slider" id="speedSlider" min="50" max="255" value="150">
                            <div class="speed-value" id="speedDisplay">150</div>
                        </div>

                        <!-- System Status -->
                        <hr>
                        <div class="status-item">
                            <div class="status-label">State</div>
                            <div class="status-value" id="stateValue">IDLE</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Battery</div>
                            <div class="progress-container battery">
                                <div class="progress-bar" id="batteryBar" style="width: 100%"></div>
                            </div>
                        </div>

                        <!-- Emergency Stop -->
                        <button class="emergency-btn mt-auto" onclick="emergencyStop()">
                            <i class="fas fa-stop-circle"></i> EMERGENCY STOP
                        </button>
                    </div>
                </div>
            </div>

            <!-- Row 2: Telemetry -->
            <div class="grid-row-2">
                <!-- Visual Odometry -->
                <div class="panel telemetry-panel">
                    <div class="panel-header"><i class="fas fa-map-marker-alt"></i> ODOMETRY</div>
                    <div class="panel-body">
                        <div class="metric-row">
                            <span>Distance:</span>
                            <span id="vo-distance" class="metric-val">0.0 cm</span>
                        </div>
                        <div class="metric-row">
                            <span>Position (X,Y):</span>
                            <span class="metric-val"><span id="vo-pos-x">0</span>, <span id="vo-pos-y">0</span></span>
                        </div>
                        <button class="btn btn-sm btn-outline-warning mt-2 w-100" onclick="resetOdometry()">Reset Pos</button>
                    </div>
                </div>

                <!-- Sensors -->
                <div class="panel telemetry-panel">
                    <div class="panel-header"><i class="fas fa-microchip"></i> SENSORS</div>
                    <div class="panel-body">
                        <div class="metric-row">
                            <span>Ultrasonic:</span>
                            <span id="ultrasonicValue" class="metric-val">-- cm</span>
                        </div>
                        <div class="metric-row">
                            <span>IMU Heading:</span>
                            <span id="imuHeading" class="metric-val">0Â°</span>
                        </div>
                    </div>
                </div>

                <!-- PID Status -->
                <div class="panel telemetry-panel">
                    <div class="panel-header"><i class="fas fa-wave-square"></i> PID</div>
                    <div class="panel-body">
                        <div class="metric-row">
                            <span>Error:</span>
                            <span id="pidError" class="metric-val">0</span>
                        </div>
                        <div class="metric-row">
                            <span>Motor L/R:</span>
                            <span id="motorValues" class="metric-val">0 / 0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>