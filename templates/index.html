<!DOCTYPE html>
<html>
<head>
    <title>Simple Auto Car</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* CSS n·ªôi b·ªô (Inline CSS) ƒë·ªÉ kh√¥ng c·∫ßn file style.css ri√™ng */
        body { 
            font-family: sans-serif; 
            text-align: center; 
            background: #222; 
            color: #fff; 
            margin: 0; 
            padding: 20px; 
        }
        
        /* Khung hi·ªÉn th·ªã Video */
        img { 
            width: 100%; 
            max-width: 640px; 
            height: auto;
            border: 3px solid #444; 
            border-radius: 8px; 
            background: #000; /* N·ªÅn ƒëen khi ch∆∞a c√≥ video */
        }
        
        /* N√∫t b·∫•m to, r√µ r√†ng, d·ªÖ ·∫•n tr√™n ƒëi·ªán tho·∫°i */
        button {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 30px auto;
            padding: 20px; 
            font-size: 22px; 
            font-weight: bold;
            color: white; 
            background: #28a745; /* M√†u xanh (Ch·∫°y) */
            border: none; 
            border-radius: 10px; 
            cursor: pointer;
            transition: background 0.3s;
        }
        
        /* Tr·∫°ng th√°i n√∫t D·ª´ng */
        button.stop { 
            background: #dc3545; /* M√†u ƒë·ªè (D·ª´ng) */
            animation: pulse 2s infinite; /* Hi·ªáu ·ª©ng nh·∫•p nh√°y nh·∫π */
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
    </style>
</head>
<body>
    <h1>üöò Camera View</h1>
    
    <div>
        <img src="/video_feed" alt="Waiting for Camera..." id="videoStream">
    </div>

    <button id="btnToggle" onclick="toggleAuto()">START AUTO MODE</button>

    <script>
        // JavaScript thu·∫ßn (Vanilla JS) ƒë·ªÉ g·ªçi API b·∫≠t/t·∫Øt
        function toggleAuto() {
            const btn = document.getElementById('btnToggle');
            
            // Hi·ªáu ·ª©ng ph·∫£n h·ªìi t·ª©c th√¨ ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt ƒë√£ b·∫•m
            btn.style.opacity = "0.7";
            
            fetch('/toggle_auto')
                .then(res => res.json())
                .then(data => {
                    btn.style.opacity = "1";
                    if (data.state === 'RUNNING') {
                        btn.innerText = "üõë STOP AUTO MODE";
                        btn.className = 'stop';
                    } else {
                        btn.innerText = "üöÄ START AUTO MODE";
                        btn.className = '';
                    }
                })
                .catch(err => {
                    btn.style.opacity = "1";
                    alert("L·ªói k·∫øt n·ªëi: " + err);
                });
        }
        
        // T·ª± ƒë·ªông t·∫£i l·∫°i trang n·∫øu video b·ªã ƒë·ª©ng (Optional)
        document.getElementById('videoStream').onerror = function() {
            console.log("Video stream lost, retrying...");
            setTimeout(() => {
                this.src = "/video_feed?" + new Date().getTime();
            }, 2000);
        };
    </script>
</body>
</html>